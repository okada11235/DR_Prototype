<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>全体平均スコア</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body{font-family:"Hiragino Sans","Meiryo",sans-serif;background:#cdeae0;margin:0;color:#333;padding-bottom:55px}
    h1{color:#007e99;font-size:1.4em;margin:20px 0;text-align:center}
    .score-section{max-width:480px;margin:0 auto;padding:0 20px}
    .score-item{display:flex;align-items:center;margin:10px 0;font-size:1em}
    .bar{height:10px;background:#d0d9ff;border-radius:5px;margin-left:10px;flex-grow:1;position:relative}
    .bar::after{content:"";position:absolute;top:0;left:0;height:100%;background:#5579ff;border-radius:5px}
    .score{color:red;font-weight:bold;margin-left:10px;min-width:3em;text-align:right}
    .record-box{background:#f8fdf9;border-radius:10px;padding:15px;margin-top:30px;box-shadow:inset 0 0 4px rgba(0,0,0,.1)}
    .record-title{font-weight:bold;margin-bottom:10px}
    .record-list{max-height:280px;overflow-y:auto;font-family:monospace;background:#fff;border-radius:8px;padding:10px;font-size:.95em}
    .list-item{display:flex;justify-content:space-between;gap:10px;padding:8px 6px;border-bottom:1px dashed #e0ece6}
    .list-item:last-child{border-bottom:none}
    .list-item a{font-weight:bold;color:#007e99;text-decoration:none}
    .list-item a:hover{text-decoration:underline}
    .custom-nav-bar{background:#378da0;border-top:2px solid #5a7d8d;box-shadow:inset 0 0 5px rgba(0,0,0,.2);height:45px}
    .custom-nav-link{color:#fff;font-weight:bold;font-size:1rem;padding:0 1rem;line-height:41px;height:100%;display:block}
    .custom-nav-item:not(:last-child){border-right:1px solid #5a7d8d}
    .active-glow .custom-nav-link.active{color:rgb(0, 0, 0);text-shadow:0 0 5px #000000,0 0 10px #7a8cff;background:rgba(255,255,255,.05)}
    .date { font-weight: bold; color: #444; }
    .time { color: #007e99; font-size: 0.95em; }
  </style>
</head>
<body>
  <h1>全体平均スコア</h1>

  <div class="score-section">
    <!-- 疑似スコア -->
    {% set labels = ["減速","加速","旋回","直進","総評"] %}
    {% for label in labels %}
    {% set val = overall_scores.get(label, 75) %}
    <div class="score-item">{{ label }}
      <div class="bar" style="--w:{{ val }}%">
        <style> .bar[style*="--w:"]::after{ width: {{ val }}%; } </style>
      </div>
      <span class="score">{{ val }}点</span>
    </div>
    {% endfor %}

    <!-- セッション一覧 -->
    <div class="record-box mt-4">
      <div class="record-title">記録一覧</div>
        <div class="record-list">
        {% if sessions %}
            {% for s in sessions %}
            <div class="list-item">
                <div>
                {% if s.start_time %}
                    {{ s.start_time.strftime('%Y/%m/%d %H:%M') }}
                    〜
                    {{ s.end_time.strftime('%H:%M') if s.end_time else '記録中' }}
                {% else %}
                    N/A
                {% endif %}
                </div>
                <div>
                距離: {{ "%.2f"|format(s.distance) if s.distance is not none else "N/A" }} km
                <br>
                <a href="{{ url_for('sessions.detail_result_page', session_id=s.id) }}">詳細へ ▶</a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            まだ記録がありません。
        {% endif %}
        </div>
    </div>
  </div>

    <nav class="navbar navbar-expand custom-nav-bar fixed-bottom">
    <div class="container-fluid justify-content-center">
        <ul class="navbar-nav w-100 text-center">
        <li class="nav-item flex-fill custom-nav-item">
            <a href="{{ url_for('views.home') }}" class="nav-link custom-nav-link">ホーム</a>
        </li>
        <li class="nav-item flex-fill custom-nav-item">
            <a href="{{ url_for('views.recording_start') }}" class="nav-link custom-nav-link">運転</a>
        </li>
        <li class="nav-item flex-fill custom-nav-item">
            <a class="nav-link custom-nav-link active" href="{{ url_for('sessions.results_page') }}">リザルト</a>
        </li>
        <li class="nav-item flex-fill custom-nav-item">
            <a class="nav-link custom-nav-link" href="#">マップ</a>
        </li>
        <li class="nav-item flex-fill custom-nav-item border-end-0">
            <a class="nav-link custom-nav-link" href="#">説明</a>
        </li>
        </ul>
    </div>
    </nav>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
