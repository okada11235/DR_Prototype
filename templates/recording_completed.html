<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ドライブバディ - 記録完了</title>

  <!-- ✅ Bootstrapを追加 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body {
      font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #cdeae0;
      color: #333;
      padding-bottom: 55px; /* ナビ分の余白 */
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-area img {
      width: 50px;
      height: 50px;
    }

    .title {
      font-size: 1.5em;
      font-weight: bold;
      color: #2090c2;
    }

    .main {
      text-align: center;
      padding: 20px;
    }

    .robot {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      background-color: #fff;
      border: 2px solid #2b8ca6;
      margin-bottom: 5px;
    }

    .main-title {
      color: #4db6ac;
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .drive-info {
      display: flex;
      justify-content: center;
      gap: 40px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .section {
      background-color: #fff;
      border-radius: 6px;
      margin: 15px auto;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      width: 90%;
      text-align: left;
    }

    .section h2 {
      font-size: 1.3em;
      color: #2090c2;
      margin-bottom: 8px;
      border-bottom: 2px solid #a5dbe0;
      padding-bottom: 4px;
    }

    .score {
      font-size: 1.6em;
      font-weight: bold;
      color: #d32f2f;
      margin-left: 5px;
    }

    .comment {
      font-size: 0.95em;
      color: #444;
      margin-top: 5px;
    }

    .highlight {
      color: #e44d8f;
      font-weight: bold;
    }

    /* === ナビバー統一スタイル（result.htmlと完全一致） === */
    .custom-nav-bar {
      background: #378da0;
      border-top: 2px solid #5a7d8d;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
      height: 45px;
    }

    /* 各項目 */
    .custom-nav-item {
      flex: 1;
    }

    .custom-nav-bar{background:#378da0;border-top:2px solid #5a7d8d;box-shadow:inset 0 0 5px rgba(0,0,0,.2);height:45px}
    .custom-nav-link{color:#fff;font-weight:bold;font-size:1rem;padding:0 1rem;line-height:41px;height:100%;display:block}
    .custom-nav-item:not(:last-child){border-right:1px solid #5a7d8d}
    .active-glow .custom-nav-link.active{color:rgb(0, 0, 0);background:rgba(255,255,255,.05)}

  </style>
</head>
<body>

  <header>
    <div class="logo-area">
      <img src="{{ url_for('static', filename='img/icon.png') }}" alt="ドライブバディロゴ">
      <div class="title">ドライブバディ</div>
    </div>
  </header>

  <main class="main">
    <img src="{{ url_for('static', filename='img/robot.png') }}" alt="ドライボ" class="robot">
    <div class="main-title">お疲れさまでした！</div>

    <div class="drive-info">
      <div>走行時間<br><span id="total-time">--:--</span></div>
      <div>走行距離<br><span id="total-distance">-- km</span></div>
    </div>

    <!-- 減速 -->
    <div class="section">
      <h2>減速 <span class="score">80点</span></h2>
      <p>結果：丁寧で安定！</p>
      <p>詳細：平均前方向G = 0.28、急ブレーキ検知 1回</p>
      <p class="comment">コメント：ブレーキのタイミング完璧！乗り心地バッチリ👏</p>
    </div>

    <!-- 加速 -->
    <div class="section">
      <h2>加速 <span class="score">75点</span></h2>
      <p>結果：少し強いかな？</p>
      <p>詳細：平均後方向G = -0.35、急発進検知 2回</p>
      <p class="comment">コメント：勢いあるドライブ！でももう少し抑えるとよりスムーズ💨</p>
    </div>

    <!-- 旋回 -->
    <div class="section">
      <h2>旋回 <span class="score">70点</span></h2>
      <p>結果：やや急め？</p>
      <p>詳細：平均横G = 0.32、急カーブ検知 4回</p>
      <p class="comment">コメント：少し内側に切り込み気味！次はもう少し外へふんわり回ろう！</p>
    </div>

    <!-- 直進 -->
    <div class="section">
      <h2>直進 <span class="score" style="color:#00796b;">90点</span></h2>
      <p>結果：安定感バッチリ！</p>
      <p>詳細：平均速度 42km/h、前後左右Gともに安定</p>
      <p class="comment">コメント：真っすぐ走行キープ！安定感すごい🔥</p>
    </div>

    <!-- 総評 -->
    <div class="section">
      <h2>総評 <span class="score" style="color:#4b63d1;">79点</span></h2>
      <p>今回の総評は79点でした！全体的に安定した運転でした👏<br>
         特に直進の安定感が素晴らしいです🚗💨<br>
         旋回時のG変化をもう少し抑えられれば、さらに上級者レベルです🔥</p>
    </div>

    <!-- 今回の重点ポイント -->
    <div class="section">
      <h2 style="color:#e44d8f;">今回の重点ポイント</h2>
      <p>今回の重点ポイントは <b>減速</b> でしたが、運転開始前と比べてとても良くなってたよ！👏<br>
      この調子で次は<b>加速</b>も意識して全体のスコアを伸ばそう🔥</p>
    </div>
  </main>

  <!-- ✅ 共通ナビバー -->
  <nav class="navbar navbar-expand custom-nav-bar fixed-bottom">
    <div class="container-fluid justify-content-center">
      <ul class="navbar-nav w-100 text-center">
        <li class="nav-item flex-fill custom-nav-item">
          <a href="{{ url_for('views.home') }}" class="nav-link custom-nav-link">ホーム</a>
        </li>
        <li class="nav-item flex-fill custom-nav-item active-glow">
          <a class="nav-link custom-nav-link active" href="{{ url_for('views.recording_start') }}">運転</a>
        </li>

        <!-- ✅ ここに active-glow を付ける（このページが“リザルト”なら） -->
        <li class="nav-item flex-fill custom-nav-item">
          <a href="{{ url_for('sessions.results_page') }}" class="nav-link custom-nav-link">リザルト</a>
        </li>

        <li class="nav-item flex-fill custom-nav-item">
          <a class="nav-link custom-nav-link" href="{{ url_for('views.map_editor') }}">マップ</a>
        </li>
        <li class="nav-item flex-fill custom-nav-item border-end-0">
          <a class="nav-link custom-nav-link" href="#">説明</a>
        </li>
      </ul>
    </div>
  </nav>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEuouICKd32x3-4y5QzA_2ovq8pydvez4",
            authDomain: "drive-prototype-32ef0.firebaseapp.com",
            projectId: "drive-prototype-32ef0",
            storageBucket: "drive-prototype-32ef0.firebasestorage.app",
            messagingSenderId: "500916744769",
            appId: "1:500916744769:web:d5a529ef05d15bb2934cc0",
            measurementId: "G-9CH5CGYCFM"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function displaySessionResults(sessionData) {
            document.getElementById('total-time').textContent = sessionData.totalTime || '--:--';
            document.getElementById('total-distance').textContent = (sessionData.distance || 0).toFixed(2) + ' km';
            // 安定度の項目を削除
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedSessionData = localStorage.getItem('lastSessionData');
            if (savedSessionData) {
                try {
                    const sessionData = JSON.parse(savedSessionData);
                    displaySessionResults(sessionData);
                    // 必要に応じてフィードバック内容を動的に変更することもできます
                    // const feedbackElement = document.getElementById('feedback-text');
                    // if(sessionData.sudden_brakes > 5) {
                    //    feedbackElement.textContent = "急ブレーキが非常に多いです！もっと注意しましょう。";
                    // }
                    localStorage.removeItem('lastSessionData');
                } catch (e) {
                    console.error('Failed to parse saved session data:', e);
                }
            }
        });
    </script>
</body>
</html>
