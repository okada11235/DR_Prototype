# OpenAI API 設定ガイド

## 概要
このアプリケーションでは、OpenAI GPT-3.5-turboを使用してより高度で自然な運転評価コメントを生成できます。APIキーが設定されていない場合は、従来のルールベース評価システムが使用されます。

## OpenAI APIキーの設定方法

### 方法1: 環境変数で直接設定
```bash
# Windows (PowerShell)
$env:OPENAI_API_KEY_DIRECT="your-openai-api-key-here"

# Windows (コマンドプロンプト)
set OPENAI_API_KEY_DIRECT=your-openai-api-key-here

# Linux/Mac
export OPENAI_API_KEY_DIRECT="your-openai-api-key-here"
```

### 方法2: ファイルで設定
1. OpenAI APIキーを取得：https://platform.openai.com/api-keys
2. ファイルを作成：`C:/Tools/openai/openai_key.txt`
3. ファイルにAPIキーを保存
4. `.env`ファイルでパスを指定：
   ```
   OPENAI_API_KEY=C:/Tools/openai/openai_key.txt
   ```

## 機能

### OpenAI API有効時の機能
- **自然な言語での評価**: GPT-3.5-turboによる人間らしいコメント生成
- **コンテキスト理解**: 運転データを総合的に分析
- **個別化されたアドバイス**: 運転者の特性に合わせたアドバイス
- **重点ポイント連携**: 選択した重点ポイントを考慮した評価

### フォールバック（APIキー無効時）の機能
- **ルールベース評価**: 事前定義されたロジックによる評価
- **基本的なコメント**: スコアに基づく標準的なコメント
- **安定した動作**: APIエラーに依存しない確実な評価

## 使用されるOpenAI API

- **モデル**: gpt-3.5-turbo
- **温度**: 0.7（創造的だが一貫性のあるレスポンス）
- **最大トークン**: 
  - 個別評価コメント: 1000トークン
  - 総評コメント: 300トークン

## エラーハンドリング

アプリケーションは以下の場合に自動的にフォールバック評価を使用します：
- APIキーが設定されていない
- APIキーが無効
- OpenAIサービスがダウンしている
- レート制限に達している
- その他のAPIエラー

## 料金について

OpenAI APIの使用には料金がかかります：
- gpt-3.5-turbo: $0.0015/1000トークン（入力）+ $0.002/1000トークン（出力）
- 1回の評価あたり約500-800トークンを使用
- 1回あたりの推定コスト: $0.001-0.002（約0.15-0.3円）

## プロダクション環境での注意点

1. **APIキーの保護**: 環境変数を使用し、コードにハードコーディングしない
2. **レート制限**: 大量のリクエストを送信する場合はレート制限に注意
3. **エラーハンドリング**: フォールバック機能により、APIエラーでもサービスが継続
4. **ログ監視**: OpenAI API呼び出しのログを監視してコストを把握

## 開発・テスト

開発環境では：
- APIキーなしでもアプリケーションは動作します
- フォールバック評価で基本機能をテストできます
- OpenAI APIを有効にする場合のみAPIキーを設定してください